# 消息的安全性
```
消息的”实时性“ ”投递可靠性“ ”时序一致性“是评价一个即实消息服务的可用性和先进性的重要指标
那另一个重要的特性”安全性“是一个IM服务的底线和立命之本
```

# 消息安全的三个维度
- 消息传输安全
- 消息存储安全
- 消息内容安全

## 传输安全
- 原因：消息在传输过程中使用的大多数是开放性的网络进行传输
- 问题1：入口被DNS劫持(被转发到其他的服务器)
    - 对于带宽路由器的DNS设置被篡改：重置路由器，修改路由器默认的登陆密码
    - 运营商LocalDNS域名劫持和调度错误：使用HttpDNS来绕开运营商的LocalDNS
- 问题2：传输链路不安全
    - 中断，攻击者破坏或者切断网络，破坏服务可用性
        - 采用多通道方式来提升链路的可用性
            - HTTPDNS服务返回多个接入IP
            - 当前传输协议切换到其它传输协议，防止某些针对特定协议的中断攻击
    - 截获，攻击者非法窃取传输的消息内容，属于被动攻击
    - 篡改，攻击者非法篡改传输的消息内容，破坏消息完整性和真实语义
    - 伪造，攻击者伪造正常的通讯消息来模拟正常用户或者模拟 IM 服务端
        - 利用私有协议和TLS技术防止截取、篡改、伪造
            - 采用二进制私有协议的IM系统由于编码问题天然具备一定的防窃取和篡改能力，比明文传输更安全
            - TLS把”对称加密算法“ ”非对称加密算法“ "秘钥交换算法" "消息认证算法" "数字签名证书" "CA认证"进行结合，解决消息传输的截取、篡改、伪造

## 存储安全
- 账号密码存储安全：单向散列算法 + 盐(很长的随机字符串) => 对密文进行存储
- 综合网络隔离、DB访问权限、存储分离
- 消息内容存储安全：端到端加密，中间传输环节都是密文。“端到端加密”的通信双方各自生成秘钥对并进行公钥的交换，私钥各自保存在本地不给到 IM 服务端。

## 内容安全
- 建立敏感词库，针对文字内容进行安全识别
- 依托图片识别技术对色情图片和视频、广告图片、涉政图片等进行处理
- 使用语言转文字和OCR（图片文本识别）来辅助对图片和语音进一步挖掘识别
- 通过爬虫技术对链接内容进一步分析，识别风险外链
- 小结：对于 IM 服务端来说，更多要做的是要建立和“识别”配套的各种惩罚处置机制(禁言处理、禁止发多媒体消息、解散群..)

# 问题和解决方案
```
1、TLS 能识别客户端模拟器仿冒用户真实访问的问题吗？如果不能有什么其他更好的办法？
TLS 巧妙地把“对称加密算法”“非对称加密算法”“秘钥交换算法”“消息认证码算法”“数字签名证书”“CA 认证”进行结合，有效地解决了消息传输过程中的截获、篡改、伪造问题。
    非对称加密算法和秘钥交换算法用于保证消息加密的密钥不被破解和泄露。
    对称加密算法对消息进行加密，保证业务数据传输过程被截获后无法破解，也无法篡改消息。
    数字签名和 CA 认证能验证证书持有者的公钥有效性，防止服务端身份的伪造。

TLS 是传输层的加密协议，无法识别仿冒的真实用户。客户端模拟器如果像真实用户一样来访问服务端
识别出恶意行为，进行识别的办法是通过机器学习的方式进行识别，例如：客户端模拟器会频繁发送消息，针对这一特征，可以对线上访问流量进行甄别。
```













