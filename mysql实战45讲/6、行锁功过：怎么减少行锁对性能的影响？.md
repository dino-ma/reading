# 问题
1. 两阶段锁协议
2. 死锁和死锁的检测

# 两阶段锁协议
```
在innodb事务中，行锁用来保证事务的一致性。行锁是需要的时候才加上的(引擎自动加上)，并不是不需要了就立刻释放，而是等到事务结束时才释放，这就是两阶段锁协议
如果事务中需要锁多个行，需要把最可能造成冲突、最可能影响并发度的锁(语句)尽量往后放
```

# 死锁和死锁的检测
- 死锁：当系统中不同线程出现循环资源相互依赖，涉及的线程都在等待别的线程释放资源。就会导致这几个线程都进入无限等待的状态
- 死锁的处理
  - 1. 进入等待直到超时 innodb_lock_wait_timeout  时间太长无法接受，时间太短容易误伤
  - 2. 发起死锁检测(引擎自动会做) innodb_deadlock_detect = on
    - 解决死锁检测要耗费大量CPU资源的问题
    - 如果业务确保不会出先死锁，可以把死锁检测关掉
    - 在中间件/进入引擎之前进行并发度控制，可以减少死锁检测的工作

