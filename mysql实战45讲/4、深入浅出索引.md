# 问题
1. 什么是索引
2. 索引常见的数据模型
3. 主键索引和普通搜索查询的区别
4. 索引的维护
5. B+树的特点是什么
6. 查询的最佳实践

# 什么是索引
```
waht：索引是在存储引擎层实现的，像innodb的索引就是B+树
why：索引是目的是为了提高数据查询的效率，就像书的目录一样
```

# 索引常见的数据模型
1. 哈希表
  - 一种以key=>val存储数据的结构，哈希值碰撞的情况下把值采用链表的方式存储(拉链法)
  - 哈希表这种结构只适合等值的查询，比如memcache等其它nosql。不适合区间范围查询(较慢)
2. 有序数组
  - 适合等值查询和范围查询
  - 插入数据比较麻烦，需要挪动后面所有记录，成本太大
3. 二叉搜索树
  - 查询、更新、插入都适合
  - 涉及到数据存储的话二叉树太高了，每个节点只有2个叉。会导致读磁盘次数增多
4. B+树

# 主键索引和普通搜索查询的区别
- 每个索引都会对应一颗B+树
- 主键索引也叫聚簇索引，主键索引在B+树的叶子节点上存储的是整行的内容
  - 主键索引的字段在B+树的叶子节点上会存放字段的值作为key(会按照字段值排序好)，value为整行的内容
- 非主键索引页叫二级索引，非主键索引在B+树的叶子节点上存储的是主键的值(查询的字段不再非主键索引对应的B+树上需要回表去查主键索引对应的B+树)
  - 非主键索引的字段在B+树的叶子节点上会存放字段的值作为key(会按照字段值排序好)，value为主键ID值

# 索引的维护
- B+树为了维护索引的有序性
  - 挪数据：在插入新值的时候会涉及挪动数据
  - 页分裂：数据页满了时，申请新的数据页，涉及挪动部分的数据
- 手动定期维护即可(合并分裂的空间=>省空间、页的利用率更高)
  - 非主键索引drop index,alter table add index
  - 主键索引alter table T engine=InnoDB

# B+树的特点是什么
- 数据量相同的情况下B+树更加"矮胖",查询时IO次数更少
- B+树每次查找都是稳定的,查找性能稳定
- B+树范围查询简单,叶子节点形成有序链表


# 查询的最佳实践
1. 主键采用int类型自增，普通索引的叶子节点的值就小，占用的空间也就越小
  - 使用业务字段直接做主键的场景，只有一个唯一索引，KV场景。没有普通索引的存在，不会回表的情况
2. 覆盖索引
  - 高频查询的字段可以建立一个索引(单个索引、符合索引中)来使用覆盖索引，避免回表查询，减少树搜索的次数。
3. 最左前缀
  - 不需要给每一种查询涉及到的字段都设计成索引，那样索引太多，浪费空间
  - 索引项是按照索引定义里面的字段顺序排序的 "关键词%"
  - 在创建复合索引的时候把高频查询的字段放在前面
4. 索引下推
  - 根据最左前缀找出来的记录中如何去掉不符合其它条件的
    - MySQL5.6之前会根据查询出的记录一个个的回表查，然后对比
    - MySQL5.6之和会对索引中包含的字段先做判定，直接过滤掉不满足条件的，减少回表次数

    